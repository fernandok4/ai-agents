# Implement Tests Command

Reads the test plan generated by `/think-on-tests` and delegates the actual test implementation to the `senior-backend-developer` subagent.

## Objective

Take the validated test case document at `docs/<path/to/the/class>.md` and produce real, working test code by delegating the implementation to the `kanasha-plugin:senior-backend-developer` agent.

## Instructions

When the user invokes this command with a class path:

1. **Read the Test Plan**: Load the test case document from `docs/<path/to/the/class>.md`:
   - If the file does not exist, abort and instruct the user to run `/think-on-tests <path/to/the/class>` first
   - Parse the full document: class info, type, dependencies, all test case groups, and priority levels

2. **Analyze Project Test Patterns**: Before delegating, gather context about how the project writes tests:
   - Use Task tool with Explore agent to find existing test files
   - Identify the test framework in use (JUnit, Jest, PHPUnit, pytest, etc.)
   - Identify test utilities, base classes, factories, fixtures, or helpers already in the project
   - Note naming conventions for test files and test methods
   - Note how mocks, stubs, and dependency injection are handled in existing tests
   - Note the folder structure for tests (e.g., `tests/`, `__tests__/`, `src/test/`, etc.)

3. **Check for Existing Test File**:
   - Search for an existing test file for the target class
   - If one exists:
     - Read its full content
     - Map which test cases from the plan are already implemented
     - **Ask the user for permission before modifying or removing any existing test**
     - Only propose modifications when an existing test is outdated, incorrect, or would break the application
     - New test cases should be appended without disturbing existing ones unless approved

4. **Delegate to Senior Backend Developer**: Use the Task tool with `kanasha-plugin:senior-backend-developer` subagent, providing a prompt that includes:
   - The full content of the test plan document
   - The project test patterns discovered (framework, conventions, utilities)
   - The existing test file content (if any) and which cases are already covered
   - Clear instruction to implement all test cases from the plan following the AAA pattern (Arrange, Act, Assert)
   - Clear instruction to follow existing project test patterns and conventions
   - Clear instruction to respect existing tests and only add or update as approved
   - Clear instruction to mark each test case with its priority from the plan

5. **Post-Implementation**:
   - Verify the generated test file compiles/parses without syntax errors
   - Report to the user which test cases were implemented, grouped by priority
   - If any test cases from the plan were skipped, explain why

## Principles

- **Plan is the source of truth**: Implement exactly what the test plan document describes, no more, no less
- **Follow project conventions**: The tests must look like they belong in the project, matching existing patterns
- **Respect existing tests**: Never overwrite or remove existing tests without explicit user permission
- **AAA discipline**: Every test must clearly follow the Arrange, Act, Assert structure
- **Priority awareness**: Implement all test cases, but clearly label priorities so the developer can review accordingly

## Usage

```
/implement-tests <path/to/the/class>
```

Examples:
```
/implement-tests src/controllers/UserController.ts
/implement-tests src/services/PaymentService.ts
/implement-tests app/Http/Controllers/OrderController.php
/implement-tests src/main/java/com/example/service/InvoiceService.java
```

The command assumes `docs/<path/to/the/class>.md` exists. If it doesn't, the command will fail and ask the user to run `/think-on-tests` first.
